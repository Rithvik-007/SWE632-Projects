<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Instant Market Online Store</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    /* Your custom styles here */
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Instant Market</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <button class="btn btn-outline-primary mr-2" onclick="showBuyerSection()">Buy</button>
        </li>
        <li class="nav-item">
          <button class="btn btn-outline-success" onclick="showSellerSection()">Sell</button>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Buyer Section -->
  <div id="buyerSection" class="container mt-4" style="display:none;">
    <h2>Search for Products</h2>
    <form id="searchForm">
      <div class="form-group">
        <input type="text" id="searchInput" class="form-control" placeholder="Enter product name">
      </div>
      <button type="submit" class="btn btn-primary">Search</button>
    </form>
    <div id="searchResults" class="mt-4">
      <!-- Matched products will be displayed here -->
    </div>
  </div>

  <!-- Seller Section -->
  <div id="sellerSection" class="container mt-4" style="display:none;">
    <h2>Sell a Product</h2>
    <form id="sellForm">
      <div class="form-group">
        <label for="productName">Product Name</label>
        <input type="text" id="productName" class="form-control" required>
      </div>
      <div class="form-group">
        <label for="productPrice">Your Price</label>
        <input type="number" id="productPrice" class="form-control" required>
      </div>
      <!-- AI Price Suggestion -->
      <div class="form-group">
        <label>Suggested Market Price:</label>
        <p id="aiSuggestion" class="font-weight-bold">--</p>
      </div>
      <button type="submit" class="btn btn-success">Submit Product</button>
    </form>
  </div>

  <!-- Transaction Modal (Bootstrap Modal) -->
  <div class="modal fade" id="transactionModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Transaction Status</h5>
          <button type="button" class="close" data-dismiss="modal">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="transactionMessage"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap & jQuery Scripts -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Your custom JavaScript -->
  <script>
    // Sample product listings array (acting as a simple in-memory database)
    let productListings = [];

    // Functions to show/hide buyer and seller sections
    function showBuyerSection() {
      document.getElementById('buyerSection').style.display = 'block';
      document.getElementById('sellerSection').style.display = 'none';
    }
    function showSellerSection() {
      document.getElementById('sellerSection').style.display = 'block';
      document.getElementById('buyerSection').style.display = 'none';
    }

    // AI Price Recommendation (Simple Example)
    function getAISuggestion(productName) {
      // For simplicity, find similar products in listings and average their prices.
      let similarProducts = productListings.filter(p => p.name.toLowerCase().includes(productName.toLowerCase()));
      if (similarProducts.length > 0) {
        let total = similarProducts.reduce((sum, p) => sum + p.price, 0);
        return (total / similarProducts.length).toFixed(2);
      } else {
        // Default suggestion if no similar products exist.
        return "Price not available";
      }
    }

    // When seller types product name, update AI suggestion in real-time.
    document.getElementById('productName').addEventListener('input', function() {
      let suggestion = getAISuggestion(this.value);
      document.getElementById('aiSuggestion').innerText = suggestion;
    });

    // Handle seller form submission
    document.getElementById('sellForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('productName').value;
      const price = parseFloat(document.getElementById('productPrice').value);
      
      // Add product to listings
      let newProduct = { name, price };
      productListings.push(newProduct);
      
      // Optional: Immediately check if any buyer search could match this product to execute a transaction.
      // For simplicity, assume the product is now available for buyers.
      
      // Provide feedback to seller
      document.getElementById('transactionMessage').innerText = "Product submitted successfully!";
      $('#transactionModal').modal('show');
      
      // Reset form fields
      this.reset();
      document.getElementById('aiSuggestion').innerText = "--";
    });

    // Handle buyer search
    document.getElementById('searchForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const query = document.getElementById('searchInput').value.toLowerCase();
      let results = productListings.filter(p => p.name.toLowerCase().includes(query));
      
      let resultsDiv = document.getElementById('searchResults');
      resultsDiv.innerHTML = "";
      
      if (results.length > 0) {
        results.forEach(product => {
          // Create a card for each matching product
          let card = document.createElement('div');
          card.className = 'card mb-3';
          card.innerHTML = `<div class="card-body">
                              <h5 class="card-title">${product.name}</h5>
                              <p class="card-text">Price: $${product.price}</p>
                              <button class="btn btn-primary" onclick="executeTransaction('${product.name}', ${product.price})">Buy Now</button>
                            </div>`;
          resultsDiv.appendChild(card);
        });
      } else {
        resultsDiv.innerHTML = "<p>No products found matching your search.</p>";
      }
    });

    // Function to simulate an immediate transaction
    function executeTransaction(name, price) {
      // Here you could add logic to remove the product from the listings.
      productListings = productListings.filter(p => !(p.name === name && p.price === price));
      
      // Provide feedback to buyer
      document.getElementById('transactionMessage').innerText = `You bought "${name}" for $${price}!`;
      $('#transactionModal').modal('show');
      
      // Optionally, refresh search results.
      document.getElementById('searchForm').dispatchEvent(new Event('submit'));
    }
  </script>
</body>
</html>
